"use strict";function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)})}}function _typeof(obj){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}var QxRequest=function QxRequest(method,url,params){return new Promise(function(resolve){var xhr=new XMLHttpRequest;xhr.onreadystatechange=function(){if(xhr.readyState===4){if(xhr.status===200){if(xhr.responseText.startsWith("<")){var responseText=xml2json(xhr.responseText);resolve(responseText)}else{resolve(JSON.parse(xhr.responseText))}}else{var query={code:-2,msg:"\u8FDE\u63A5\u5F02\u5E38\uFF01"};resolve(query)}}};if(method==="get"||method==="GET"){if(_typeof(params)==="object"){params=Object.keys(params).map(function(key){return encodeURIComponent(key)+"="+encodeURIComponent(params[key])}).join("&")}url=params?url+"?"+params:url;xhr.open(method,url,true);xhr.timeout=8000;xhr.send()}if(method==="post"||method==="POST"){xhr.open(method,url,true);xhr.setRequestHeader("Accept","*/*");xhr.timeout=8000;xhr.send(JSON.stringify(params))}})};var xml2json=function xml2json(val){var x2js=new X2JS;return x2js.xml_str2json(val)};var base_url="http://127.0.0.1:9585/icvs2/";var webcu2plugin={login:function(){var _login=_asyncToGenerator(regeneratorRuntime.mark(function _callee(params,callback){var reslut,res,url,ws;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:reslut={code:-1};_context.next=3;return QxRequest("post","".concat(base_url,"login"),params);case 3:res=_context.sent;if(res.msg==="OK"){reslut.code=0;reslut.msg=res.msg;reslut.token=res.token;url=websocket_url+"?token="+res.token;ws=new WebSocket(url);ws.onmessage=function(evt){if(_typeof(evt)==="object"&&evt.data&&callback){var msg=xml2json(evt.data).M;if(msg._Type==="PlayEvent"){var _params={type:"playEvent",data:{status:msg._Status,palyId:msg._PlayID}};callback(_params)}if(msg._Type==="DownlaodEvent"){var _params2={type:"downlaodEvent",data:{status:msg._Status,palyId:msg._DownloadID}};callback(_params2)}var event=msg.E||null;if(event){if(event._ID==="E_CU_Online"){var _params3={type:"userOnline",data:{UserID:event.Desc._UserID,EPID:event.Desc._EPID}};callback(_params3)}else if(event._ID==="E_CU_Offline"){var _params4={type:"userOffline",data:{UserID:event.Desc._UserID,EPID:event.Desc._EPID}};callback(_params4)}else if(event._ID==="E_PU_Online"){var _params5={type:"deviceOnline",data:{Name:event.Src._Name,Type:event.Src._Type,Idx:event.Src._Idx,Desc:event.Src._Desc}};callback(_params5)}else if(event._ID==="E_PU_Offline"){var _params6={type:"deviceOffline",data:{Name:event.Src._Name,Type:event.Src._Type,Idx:event.Src._Idx,Desc:event.Src._Desc}};callback(_params6)}else if(event._ID==="E_GS_GPSDataUpdate"){}else if(event._ID==="PlayNtf"){console.log("playNtf");console.log(event)}}}};ws.onclose=function(){var params={type:"Error"};callback(params)};ws.onerror=function(){var params={type:"Error"};callback(params)}}else{reslut=res}return _context.abrupt("return",reslut);case 6:case"end":return _context.stop();}}},_callee)}));function login(_x,_x2){return _login.apply(this,arguments)}return login}(),getDeviceList:function getDeviceList(params){return QxRequest("get","".concat(base_url,"CAS/C_CAS_QueryPUIDSets"),params)},getDeviceByPuid:function getDeviceByPuid(params){return QxRequest("get","".concat(base_url,"C_CAS_QueryPUIDRes"),params)},getPlayVideoId:function getPlayVideoId(params){return QxRequest("get","".concat(base_url,"video/startVideo2"),params)},ptzControl:function ptzControl(params){var puid=params.puid||"";var idx=params.idx||0;var control=params.control||"";var speed=params.speed||"";var xml="";var token=params.token;if(!puid||!control){return}if(control==="left"||control==="up"||control==="right"||control==="down"||control==="stop"){var _params7={puid:puid,motion:control,idx:idx,token:token,speed:speed};return QxRequest("post","".concat(base_url,"PTZ/C_PTZ_Turn"),_params7)}if(control==="zoomin"){var _params8={speed:speed,puid:puid,idx:idx,token:token};return QxRequest("post","".concat(base_url,"PTZ/C_PTZ_ZoomInPicture"),_params8)}if(control==="zoomout"){var _params9={speed:speed,puid:puid,idx:idx,token:token};return QxRequest("post","".concat(base_url,"PTZ/C_PTZ_ZoomOutPicture"),_params9)}if(control==="stopzoom"){var _params10={speed:speed,puid:puid,idx:idx,token:token};return QxRequest("post","".concat(base_url,"PTZ/C_PTZ_StopPictureZoom"),_params10)}if(control==="focusfar"){var _params11={speed:speed,puid:puid,idx:idx,token:token};return QxRequest("post","".concat(base_url,"PTZ/C_PTZ_MakeFocusFar"),_params11)}if(control==="focusnear"){var _params12={speed:speed,puid:puid,idx:idx,token:token};return QxRequest("post","".concat(base_url,"PTZ/C_PTZ_MakeFocusNear"),_params12)}if(control==="stopfocus"){var _params13={speed:speed,puid:puid,idx:idx,token:token};return QxRequest("post","".concat(base_url,"PTZ/C_PTZ_StopFocusMove"),_params13)}if(control==="augment"){xml="<?xml version=\"1.0\" encoding=\"UTF-8\"?><M Type=\"ComReq\"><C Type=\"G\" Prio=\"1\" EPID=\"system\" Lang=\"zh_CN\"> <Res Type=\"IV\" Idx=\""+idx+"\" OptID=\"C_PTZ_AugmentAperture\" Stream=\"0\"><Param></Param></Res></C></M>";var url="".concat(base_url,"RawRequest?dstType=201&dstID=").concat(puid,"&token=").concat(token);var _params14={xml:xml};return QxRequest("post",url,_params14)}if(control==="minish"){xml="<?xml version=\"1.0\" encoding=\"UTF-8\"?><M Type=\"ComReq\"><C Type=\"G\" Prio=\"1\" EPID=\"system\" Lang=\"zh_CN\"><Res Type=\"IV\" Idx=\""+idx+"\" OptID=\"C_PTZ_MinishAperture\" Stream=\"0\"><Param></Param></Res></C></M>";var _url="".concat(base_url,"RawRequest?dstType=201&dstID=").concat(puid,"&token=").concat(token);var _params15={xml:xml};return QxRequest("post",_url,_params15)}if(control==="stopaperture"){xml="<?xml version=\"1.0\" encoding=\"UTF-8\"?><M Type=\"ComReq\"><C Type=\"G\" Prio=\"1\" EPID=\"system\" Lang=\"zh_CN\"><Res Type=\"IV\" Idx=\""+idx+"\" OptID=\"C_PTZ_StopApertureZoom\" Stream=\"0\"><Param></Param></Res></C></M>";var _url2="".concat(base_url,"RawRequest?dstType=201&dstID=").concat(puid,"&token=").concat(token);var _params16={xml:xml};return QxRequest("post",_url2,_params16)}},getPresetPosList:function(){var _getPresetPosList=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(query){var result,idx,puid,token,xml,url,params,data;return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:result={code:-1,rows:[]};idx=query.idx||"0";puid=query.puid||"";token=query.token||"";xml="<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n    <M Type=\"ComReq\">\n      <C Type=\"G\" Prio=\"1\" EPID=\"system\" Lang=\"zh_CN\">\n        <Res Type=\"PTZ\" Idx=\"".concat(idx,"\" OptID=\"F_PTZ_PresetPositionSets\" Stream=\"0\"><Param></Param></Res>\n      </C>\n    </M>");url="".concat(base_url,"RawRequest?dstType=201&dstID=").concat(puid,"&token=").concat(token);params={xml:xml};_context2.next=9;return QxRequest("post",url,params);case 9:data=_context2.sent;try{result.rows=data.M.C.Res.Param.Preset;result.code=data.M.C._SPError}catch(error){result.msg="fail"}return _context2.abrupt("return",result);case 12:case"end":return _context2.stop();}}},_callee2)}));function getPresetPosList(_x3){return _getPresetPosList.apply(this,arguments)}return getPresetPosList}(),setPresetPos:function setPresetPos(params){return QxRequest("post","".concat(base_url,"PTZ/C_PTZ_SetPresetPos"),params)},moveToPresetPos:function moveToPresetPos(params){return QxRequest("post","".concat(base_url,"PTZ/C_PTZ_MoveToPresetPos"),params)},gotoOriginalPresetPos:function gotoOriginalPresetPos(params){return QxRequest("post","".concat(base_url,"PTZ/C_PTZ_GotoOriginalPresetPos"),params)},startCloudSnapshot:function startCloudSnapshot(params){return QxRequest("post","".concat(base_url,"CSS/C_CSS_StartManualSnapshot"),params)},startCloudStorage:function startCloudStorage(params){return QxRequest("post","".concat(base_url,"CSS/C_CSS_StartManualStorage"),params)},stopCloudStorage:function stopCloudStorage(params){return QxRequest("post","".concat(base_url,"CSS/C_CSS_StopManualStorage"),params)},startSGSnapshot:function startSGSnapshot(params){return QxRequest("get","".concat(base_url,"SG/C_SG_StartSnapshot"),params)},startSGStorage:function startSGStorage(params){params.IVIdx=params.idx||"0";return QxRequest("get","".concat(base_url,"SG/VODFile.flv"),params)},startTalk:function startTalk(params){return QxRequest("get","".concat(base_url,"audio/startTalk2"),params)},startCall:function startCall(params){return QxRequest("get","".concat(base_url,"audio/startCall2"),params)},stoptStream:function stoptStream(params){return QxRequest("get","".concat(base_url,"stopPlay2"),params)},enablePlayAudio:function enablePlayAudio(params){return QxRequest("get","".concat(base_url,"enablePlayAudio"),params)},startLocalSnap:function startLocalSnap(params){return QxRequest("get","".concat(base_url,"localSnapshot2"),params)},startLocalSnapShot:function startLocalSnapShot(params){return QxRequest("get","".concat(base_url,"localSerialSnapshot2"),params)},stopLocalSnapShot:function stopLocalSnapShot(params){return QxRequest("get","".concat(base_url,"cancelLocalSerialSnapshot2"),params)},startLocalVideo:function startLocalVideo(params){return QxRequest("get","".concat(base_url,"localRecord2"),params)},stopLocalVideo:function stopLocalVideo(params){return QxRequest("get","".concat(base_url,"CancelLocalRecord2"),params)},getCloudFile:function getCloudFile(params){return QxRequest("get","".concat(base_url,"CSS/C_CSS_QueryStorageFiles"),params)},getDeviceFile:function getDeviceFile(params){return QxRequest("get","".concat(base_url,"SG/C_SG_QueryRecordFiles"),params)},downloadCloudFile:function downloadCloudFile(params){return QxRequest("get","".concat(base_url,"downloadCloudFile2"),params)},downloadDeviceFile:function downloadDeviceFile(params){return QxRequest("get","".concat(base_url,"downloadDeviceFile2"),params)},setPuaseDownload:function setPuaseDownload(params){return QxRequest("get","".concat(base_url,"puaseDownload2"),params)},setRestoreDownload:function setRestoreDownload(params){return QxRequest("get","".concat(base_url,"restoreDownload2"),params)},setStopDownload:function setStopDownload(params){return QxRequest("get","".concat(base_url,"stopDownload2"),params)},getVodCloudFile:function getVodCloudFile(params){return QxRequest("get","".concat(base_url,"vodCloudFile2"),params)},getVodDeviceFile:function getVodDeviceFile(params){return QxRequest("get","".concat(base_url,"vodDeviceFile2"),params)},setPuaseVod:function setPuaseVod(params){return QxRequest("get","".concat(base_url,"puaseVod2"),params)},setRestoreVod:function setRestoreVod(params){return QxRequest("get","".concat(base_url,"restoreVod2"),params)},setSpeedVod:function setSpeedVod(params){return QxRequest("get","".concat(base_url,"setVodSpeed2"),params)},setOffsetVod:function setOffsetVod(params){return QxRequest("get","".concat(base_url,"setVodOffset2"),params)},subscriptionGps:function subscriptionGps(params){var token=params.token;var epid=params.epid||"";var puid=params.puid||"";var idx=params.idx||0;var xml="<?xml version=\"1.0\" encoding=\"UTF-8\"?><M Type=\"ComReq\"><C Type=\"C\" EPID=\""+epid+"\"><Res Type=\"ST\" Idx=\""+idx+"\" OptID=\"C_GS_SubscribeGPSData\"><Param></Param></Res></C><OSets><Res OType=\"201\" OID=\""+puid+"\" Type=\"GPS\" Idx=\""+idx+"\"></Res></OSets></M>";var url=base_url+"RawRequest?dstType=33&token="+token;var params1={xml:xml};return QxRequest("POST",url,params1)},getPuidLastGps:function getPuidLastGps(params){var token=params.token;var puid=params.puid||[];var epid=params.epid||"";var Osets="<OSets>";Osets+="<Res OType=\"201\" OID=\""+puid+"\" Type=\"GPS\" Idx=\"0\"></Res>";Osets+="</OSets>";var xml="<?xml version=\"1.0\" encoding=\"UTF-8\"?><M Type=\"ComReq\"><C Type=\"C\" EPID=\""+epid+"\"><Res Type=\"ST\" Idx=\"0\" OptID=\"C_GS_QueryLastGPSData\"><Param></Param></Res></C>"+Osets+"</M>";var url=base_url+"RawRequest?dstType=33&dstID=\"\"&token="+token;var params1={xml:xml};return QxRequest("POST",url,params1)},getPuidHistoryGps:function getPuidHistoryGps(params){var token=params.token;var offset=params.offset||0;var count=params.count||100;var begin=params.begin;var end=params.end;var puid=params.puid;var epid=params.epid||"";var Osets="<OSets>";Osets+="<Res OType=\"201\" OID=\""+puid+"\" Type=\"ST\" Idx=\"0\"></Res>";Osets+="</OSets>";var xml="<?xml version=\"1.0\" encoding=\"UTF-8\"?><M Type=\"ComReq\"><C Type=\"C\" EPID=\""+epid+"\"><Res Type=\"ST\" Idx=\"0\" OptID=\"C_GS_QueryHistoryGPSData\"><Param  Offset=\""+offset+"\" Count=\""+count+"\" Begin=\""+begin+"\" End=\""+end+"\"></Param></Res></C>"+Osets+"</M>";var url=base_url+"RawRequest?dstType=33&dstID=\"\"&token="+token;var params1={xml:xml};return QxRequest("POST",url,params1)}};define("main",[],function(){});